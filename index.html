<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Papyonu Bulma Oyunu</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            width: 100vw;
            height: 100vh;
            overflow: hidden; 
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #game-container { position: relative; }
        #button-grid { display: grid; position: relative; }
        .game-button {
            position: relative;
            overflow: hidden;
            border: 2px solid theme('colors.gray.700');
            transition: transform 0.1s ease-in-out;
        }
        .button-content {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transition: transform 0.3s ease-in-out;
            object-fit: cover;
        }
        .content-hidden { transform: scale(0); }
        .content-visible { transform: scale(1); }
    </style>
</head>
<body class="bg-gray-900 text-white p-4">
    <div id="game-container" class="relative w-full max-w-sm h-auto bg-gray-800 rounded-2xl shadow-lg p-6 flex flex-col justify-center">
        
        <div class="text-center mb-6">
            <h1 class="text-3xl sm:text-4xl font-extrabold text-amber-400">Papyonu Bulma Oyunu</h1>
            <p class="text-xs sm:text-sm text-gray-400 mt-1">Doğru papyonu bulmak için butonlara tıkla!</p>
        </div>

        <div id="button-grid" class="w-full grid grid-cols-2 gap-0.5 place-items-center">
            </div>

        <div id="win-message" class="hidden fixed inset-0 flex items-center justify-center bg-black bg-opacity-70 z-20 p-4">
            <div class="bg-green-500 text-white text-center p-8 rounded-xl shadow-2xl">
                <h2 class="text-3xl sm:text-4xl font-extrabold">Tebrikler Papyonu buldun!</h2>
                <p class="text-base font-light text-white mt-3">Ekran görüntüsü al, linki aç, sayfayı takip et ve buz gibi kahveni kap!</p>
                <div id="win-code" class="my-4 text-4xl font-bold text-amber-300 tracking-wider"></div>
                <div class="flex justify-center mt-4">
                    <a href="https://www.instagram.com/papyon.caffe/" id="win-link" class="px-6 py-3 bg-white text-green-500 font-bold rounded-full text-xl hover:bg-gray-200 flex items-center justify-center">
                      Linki Aç
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div id="already-played-message" class="hidden text-center text-white">
        <h1 class="text-3xl font-bold text-amber-400">Oyun Bitti!</h1>
        <p class="mt-2 text-lg">Bu oyunu daha önce oynadınız.</p>
    </div>


    <script>
        window.onload = function() {
            const gameContainer = document.getElementById('game-container');
            const alreadyPlayedMessage = document.getElementById('already-played-message');

            if (localStorage.getItem('papyonOyunuBitti') === 'true') {
                gameContainer.style.display = 'none';
                alreadyPlayedMessage.classList.remove('hidden');
            } else {
                initializeGame();
            }

            function initializeGame() {
                const buttonGrid = document.getElementById('button-grid');
                const winMessage = document.getElementById('win-message');
                const winCodeElement = document.getElementById('win-code');

                const totalButtons = 4;
                // NOT: Bu linkteki resmin arka planını şeffaf yapmak için resmi düzenlemeniz gerekir.
                const hiddenImageUrl = 'https://i.hizliresim.com/gbmorh5.jpg?_gl=1*1kilc35*_ga*NDgzMjAxNzQ4LjE3NTQ5MDgzMTI.*_ga_M9ZRXYS2YN*czE3NTQ5NDIzNzUkbzUkZzEkdDE3NTQ5NDU2MTEkajM5JGwwJGgw';
                const correctImageUrl = 'https://i.hizliresim.com/ivzknin.png';
                const wrongImageUrls = [
                    'https://i.hizliresim.com/df3zzna.png?_gl=1*19qox6e*_ga*NDgzMjAxNzQ4LjE3NTQ5MDgzMTI.*_ga_M9ZRXYS2YN*czE3NTQ5NDIzNzUkbzUkZzEkdDE3NTQ5NDUzMDEkajMxJGwwJGgw',
'https://i.hizliresim.com/bktuopu.png?_gl=1*1s8k23f*_ga*NDgzMjAxNzQ4LjE3NTQ5MDgzMTI.*_ga_M9ZRXYS2YN*czE3NTQ5NDIzNzUkbzUkZzEkdDE3NTQ5NDUzMTAkajIyJGwwJGgw',
'https://i.hizliresim.com/trs1g07.png?_gl=1*1uki6nf*_ga*NDgzMjAxNzQ4LjE3NTQ5MDgzMTI.*_ga_M9ZRXYS2YN*czE3NTQ5NDIzNzUkbzUkZzEkdDE3NTQ5NDUzMTMkajE5JGwwJGgw',
'https://i.hizliresim.com/7vrc4qh.png?_gl=1*mv7pet*_ga*NDgzMjAxNzQ4LjE3NTQ5MDgzMTI.*_ga_M9ZRXYS2YN*czE3NTQ5NDIzNzUkbzUkZzEkdDE3NTQ5NDUyMTYkajUzJGwwJGgw',
'https://i.hizliresim.com/d6z3k03.png?_gl=1*102stac*_ga*NDgzMjAxNzQ4LjE3NTQ5MDgzMTI.*_ga_M9ZRXYS2YN*czE3NTQ5NDIzNzUkbzUkZzEkdDE3NTQ5NDUyMjgkajQxJGwwJGgw',
'https://i.hizliresim.com/lrxcbhl.png?_gl=1*1mtrlgr*_ga*NDgzMjAxNzQ4LjE3NTQ5MDgzMTI.*_ga_M9ZRXYS2YN*czE3NTQ5NDIzNzUkbzUkZzEkdDE3NTQ5NDUyMzUkajM0JGwwJGgw',
'https://i.hizliresim.com/6w7mpjo.png?_gl=1*1mjgzm5*_ga*NDgzMjAxNzQ4LjE3NTQ5MDgzMTI.*_ga_M9ZRXYS2YN*czE3NTQ5NDIzNzUkbzUkZzEkdDE3NTQ5NDU0NzgkajUxJGwwJGgw',
                    'https://i.hizliresim.com/585p5uc.png',
                    'https://i.hizliresim.com/ja6rsaw.png',
                    'https://i.hizliresim.com/asrqt7o.png',
                    'https://i.hizliresim.com/l6dowwl.png',
                    'https://i.hizliresim.com/n15j1q4.png',
                    'https://i.hizliresim.com/7eupry5.png',
                    'https://i.hizliresim.com/hb4jbzr.png',
                    'https://i.hizliresim.com/lv9hsb9.png',
                    'https://i.hizliresim.com/6o0krpi.png',
                    'https://i.hizliresim.com/sco84hp.png'
                ];
                const buttonColors = ['bg-red-500', 'bg-blue-500', 'bg-green-500', 'bg-purple-500'];

                let isGameOver = false;
                let isAnimating = false;
                let clickCount = 0;
                let wrongImageAssignment = [];
                // DÜZENLEME: Son gösterilen yanlış resmi takip etmek için değişken
                let lastWrongImageUrl = '';

                function resetGame() {
                    isGameOver = false;
                    isAnimating = false;
                    clickCount = 0;
                    winMessage.classList.add('hidden');
                    wrongImageAssignment = [...wrongImageUrls];
                    shuffleArray(wrongImageAssignment);
                    createButtons();
                    shufflePositions();
                }

                function shuffleArray(array) {
                    for (let i = array.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        [array[i], array[j]] = [array[j], array[i]];
                    }
                }

                function shufflePositions() {
                    const buttons = Array.from(buttonGrid.children);
                    if (buttons.length === 0) return;
                    const initialPositions = buttons.map(button => button.getBoundingClientRect());
                    const shuffledButtons = [...buttons];
                    shuffleArray(shuffledButtons);
                    shuffledButtons.forEach(button => buttonGrid.appendChild(button));
                    const finalPositions = buttons.map(button => button.getBoundingClientRect());
                    buttons.forEach((button, index) => {
                        const originalButtonOrder = buttons.findIndex(b => b === shuffledButtons[index]);
                        const deltaX = initialPositions[originalButtonOrder].left - finalPositions[index].left;
                        const deltaY = initialPositions[originalButtonOrder].top - finalPositions[index].top;
                        button.style.transition = 'none';
                        button.style.transform = `translate(${deltaX}px, ${deltaY}px)`;
                        requestAnimationFrame(() => {
                            requestAnimationFrame(() => {
                                button.style.transition = 'transform 0.1s ease-in-out';
                                button.style.transform = '';
                            });
                        });
                    });
                }

                function createButtons() {
                    buttonGrid.innerHTML = '';
                    for (let i = 0; i < totalButtons; i++) {
                        const button = document.createElement('button');
                        button.classList.add('game-button', buttonColors[i % buttonColors.length], 'text-4xl', 'font-bold', 'text-white', 'p-4', 'rounded-xl', 'shadow-md', 'transition-colors', 'duration-150', 'ease-in-out', 'aspect-square', 'w-full');
                        button.dataset.buttonIndex = i;
                        const hiddenImage = document.createElement('img');
                        hiddenImage.src = hiddenImageUrl;
                        hiddenImage.classList.add('button-content', 'content-visible');
                        button.appendChild(hiddenImage);
                        const revealedImage = document.createElement('img');
                        revealedImage.src = wrongImageAssignment[i];
                        revealedImage.classList.add('button-content', 'content-hidden');
                        button.appendChild(revealedImage);
                        buttonGrid.appendChild(button);
                    }
                }

                function revealButton(button, imageUrl, isCorrect) {
                    const hiddenImage = button.querySelector('.content-visible');
                    const revealedImage = button.querySelector('.content-hidden');
                    revealedImage.src = imageUrl;
                    if (hiddenImage) hiddenImage.classList.replace('content-visible', 'content-hidden');
                    if (revealedImage) revealedImage.classList.replace('content-hidden', 'content-visible');
                    if (isCorrect) {
                        winMessage.classList.remove('hidden');
                        isGameOver = true;
                        isAnimating = false;
                    } else {
                        setTimeout(() => {
                            if (revealedImage) revealedImage.classList.replace('content-visible', 'content-hidden');
                            if (hiddenImage) hiddenImage.classList.replace('content-hidden', 'content-visible');
                            setTimeout(() => {
                                isAnimating = false;
                                if (!isGameOver) {
                                    shufflePositions();
                                }
                            }, 100);
                        }, 500);
                    }
                }

                buttonGrid.addEventListener('click', (event) => {
                    if (isGameOver || isAnimating) return;
                    const clickedButton = event.target.closest('button');
                    if (!clickedButton) return;
                    isAnimating = true;
                    clickCount++;
                    if (clickCount === 49) {
                        const randomNumber = Math.floor(Math.random() * 9000) + 1000;
                        winCodeElement.textContent = randomNumber;
                        localStorage.setItem('papyonOyunuBitti', 'true');
                        revealButton(clickedButton, correctImageUrl, true);
                    } else {
                        // DÜZENLEME: Her tıklamada farklı ve tekrar etmeyen bir yanlış resim seç
                        let randomWrongImage;
                        do {
                            randomWrongImage = wrongImageUrls[Math.floor(Math.random() * wrongImageUrls.length)];
                        } while (wrongImageUrls.length > 1 && randomWrongImage === lastWrongImageUrl);
                        
                        lastWrongImageUrl = randomWrongImage; // Son gösterilen resmi hafızaya al
                        
                        revealButton(clickedButton, randomWrongImage, false);
                    }
                });

                resetGame();
            }
        };
    </script>
</body>
</html>
